const STORE = {
    questions: {
      accessibility: [
        {
          question: "Who is known as the father of Western philosophy?",
          code: ``,
          answers: [
            "Socrates",
            "Plato",
            "Aristotle",
            "Descartes"
          ],
          correctAnswer: "Socrates"
        },
        {
          question: "Which philosopher is famous for the concept of 'the social contract'?",
          code: ``,
          answers: [
            "Hobbes",
            "Locke",
            "Rousseau",
            "Kant"
          ],
          correctAnswer: "Rousseau"
        },
        {
          question: "What is the main focus of existentialism?",
          code: ``,
          answers: [
            "The nature of being and individual freedom",
            "The analysis of social structures",
            "The study of moral principles",
            "The role of the state in human affairs"
          ],
          correctAnswer: "The nature of being and individual freedom"
        },
        {
          question: "Which philosopher is known for the statement 'I think, therefore I am'?",
          code: ``,
          answers: [
            "Hume",
            "Descartes",
            "Nietzsche",
            "Sartre"
          ],
          correctAnswer: "Descartes"
        },
        {
          question: "Which school of thought argues that the mind is a blank slate at birth?",
          code: ``,
          answers: [
            "Empiricism",
            "Rationalism",
            "Idealism",
            "Pragmatism"
          ],
          correctAnswer: "Empiricism"
        }
      ],
      arrays: [
        {
          question: "What year did the Berlin Wall fall?",
          code: ``,
          answers: [
            "1987",
            "1988",
            "1989",
            "1990"
          ],
          correctAnswer: "1989"
        },
        {
          question: "Who was the first Emperor of China?",
          code: ``,
          answers: [
            "Qin Shi Huang",
            "Han Gaozu",
            "Tang Taizong",
            "Yuan Shikai"
          ],
          correctAnswer: "Qin Shi Huang"
        },
        {
          question: "Which war was fought between the Allies and the Central Powers?",
          code: ``,
          answers: [
            "World War I",
            "World War II",
            "The Korean War",
            "The Vietnam War"
          ],
          correctAnswer: "World War I"
        },
        {
          question: "Who was the leader of the Soviet Union during World War II?",
          code: ``,
          answers: [
            "Leon Trotsky",
            "Joseph Stalin",
            "Nikita Khrushchev",
            "Vladimir Lenin"
          ],
          correctAnswer: "Joseph Stalin"
        },
        {
          question: "What was the primary cause of the American Civil War?",
          code: ``,
          answers: [
            "Economic differences between North and South",
            "Territorial expansion",
            "Foreign intervention",
            "Religious differences"
          ],
          correctAnswer: "Economic differences between North and South"
        }
      ],
      elements: [
        {
          question: "Which political philosophy advocates for minimal government intervention in personal and economic matters?",
          code: ``,
          answers: [
            "Liberalism",
            "Socialism",
            "Libertarianism",
            "Communism"
          ],
          correctAnswer: "Libertarianism"
        },
        {
          question: "What is the name of the economic system where the means of production are owned and controlled by the state?",
          code: ``,
          answers: [
            "Capitalism",
            "Feudalism",
            "Socialism",
            "Mercantilism"
          ],
          correctAnswer: "Socialism"
        },
        {
          question: "Which document established the framework for the government of the United States?",
          code: ``,
          answers: [
            "The Declaration of Independence",
            "The Bill of Rights",
            "The Federalist Papers",
            "The Constitution"
          ],
          correctAnswer: "The Constitution"
        },
        {
          question: "What is the primary role of the judiciary in a democratic government?",
          code: ``,
          answers: [
            "To create laws",
            "To enforce laws",
            "To interpret laws",
            "To veto laws"
          ],
          correctAnswer: "To interpret laws"
        },
        {
          question: "Which U.S. President delivered the Gettysburg Address?",
          code: ``,
          answers: [
            "Abraham Lincoln",
            "George Washington",
            "Thomas Jefferson",
            "Andrew Johnson"
          ],
          correctAnswer: "Abraham Lincoln"
        }
      ],
      flexbox: [
        {
          question: "Which is the largest continent by land area?",
          code: ``,
          answers: [
            "Africa",
            "Asia",
            "Europe",
            "North America"
          ],
          correctAnswer: "Asia"
        },
        {
          question: "What is the longest river in the world?",
          code: ``,
          answers: [
            "Amazon River",
            "Nile River",
            "Yangtze River",
            "Mississippi River"
          ],
          correctAnswer: "Nile River"
        },
        {
          question: "Which country is known as the Land of the Rising Sun?",
          code: ``,
          answers: [
            "China",
            "Japan",
            "South Korea",
            "Thailand"
          ],
          correctAnswer: "Japan"
        },
        {
          question: "What is the capital city of Australia?",
          code: ``,
          answers: [
            "Sydney",
            "Melbourne",
            "Canberra",
            "Brisbane"
          ],
          correctAnswer: "Canberra"
        },
        {
          question: "Which desert is the largest hot desert in the world?",
          code: ``,
          answers: [
            "Sahara Desert",
            "Gobi Desert",
            "Karakum Desert",
            "Kalahari Desert"
          ],
          correctAnswer: "Sahara Desert"
        }
      ],
      forms: [
        {
          question: "What is the chemical symbol for gold?",
          code: ``,
          answers: [
            "Au",
            "Ag",
            "Pb",
            "Fe"
          ],
          correctAnswer: "Au"
        },
        {
          question: "Who wrote the play 'Romeo and Juliet'?",
          code: ``,
          answers: [
            "William Shakespeare",
            "George Bernard Shaw",
            "Jane Austen",
            "Charles Dickens"
          ],
          correctAnswer: "William Shakespeare"
        },
        {
          question: "What is the hardest natural substance on Earth?",
          code: ``,
          answers: [
            "Gold",
            "Diamond",
            "Platinum",
            "Iron"
          ],
          correctAnswer: "Diamond"
        },
        {
          question: "In which year did the Titanic sink?",
          code: ``,
          answers: [
            "1912",
            "1905",
            "1923",
            "1898"
          ],
          correctAnswer: "1912"
        },
        {
          question: "What is the largest planet in our Solar System?",
          code: ``,
          answers: [
            "Earth",
            "Mars",
            "Jupiter",
            "Saturn"
          ],
          correctAnswer: "Jupiter"
        }
      ],
      loops: [
          {
            question: "Who is known as the father of Western philosophy?",
            code: ``,
            answers: [
              "Aristotle",
              "Socrates",
              "Plato",
              "Descartes"
            ],
            correctAnswer: "Socrates"
          },
          {
            question: "What is the main focus of existentialism?",
            code: ``,
            answers: [
              "The nature of reality",
              "The individual's experience and freedom",
              "The study of the universe",
              "The nature of knowledge"
            ],
            correctAnswer: "The individual's experience and freedom"
          },
          {
            question: "Which philosopher is associated with the concept of the 'social contract'?",
            code: ``,
            answers: [
              "John Locke",
              "Jean-Jacques Rousseau",
              "Immanuel Kant",
              "Friedrich Nietzsche"
            ],
            correctAnswer: "Jean-Jacques Rousseau"
          },
          {
            question: "What is the central idea of Platonic idealism?",
            code: ``,
            answers: [
              "Reality is based on material objects",
              "The physical world is a reflection of a higher reality",
              "Knowledge is derived solely from sensory experience",
              "All reality is subjective and based on individual perception"
            ],
            correctAnswer: "The physical world is a reflection of a higher reality"
          },
          {
            question: "Which philosopher is known for the concept of 'will to power'?",
            code: ``,
            answers: [
              "Karl Marx",
              "Friedrich Nietzsche",
              "Georg Wilhelm Friedrich Hegel",
              "Martin Heidegger"
            ],
            correctAnswer: "Friedrich Nietzsche"
          }
      ],
      methods: [
          {
            question: "Which of the following is the holy book of Islam?",
            code: ``,
            answers: [
              "Bible",
              "Torah",
              "Vedas",
              "Quran"
            ],
            correctAnswer: "Quran"
          },
          {
            question: "In Hinduism, who is considered the creator of the universe?",
            code: ``,
            answers: [
              "Vishnu",
              "Shiva",
              "Brahma",
              "Lakshmi"
            ],
            correctAnswer: "Brahma"
          },
          {
            question: "Which religion is known for the Eightfold Path?",
            code: ``,
            answers: [
              "Hinduism",
              "Buddhism",
              "Christianity",
              "Islam"
            ],
            correctAnswer: "Buddhism"
          },
          {
            question: "What is the main religious text of Judaism?",
            code: ``,
            answers: [
              "Bible",
              "Quran",
              "Tanakh",
              "Vedas"
            ],
            correctAnswer: "Tanakh"
          },
          {
            question: "Which religion celebrates Diwali?",
            code: ``,
            answers: [
              "Hinduism",
              "Islam",
              "Christianity",
              "Buddhism"
            ],
            correctAnswer: "Hinduism"
          }
      ],
      CSS: [
          {
            question: "Which sport is known as 'the beautiful game'?",
            code: ``,
            answers: [
              "Basketball",
              "Tennis",
              "Football (Soccer)",
              "Cricket"
            ],
            correctAnswer: "Football (Soccer)"
          },
          {
            question: "Which country won the FIFA World Cup in 2018?",
            code: ``,
            answers: [
              "Brazil",
              "France",
              "Germany",
              "Argentina"
            ],
            correctAnswer: "France"
          },
          {
            question: "Who holds the record for the most Olympic gold medals?",
            code: ``,
            answers: [
              "Michael Phelps",
              "Usain Bolt",
              "Carl Lewis",
              "Larisa Latynina"
            ],
            correctAnswer: "Michael Phelps"
          },
          {
            question: "Which tennis player has won the most Grand Slam singles titles?",
            code: ``,
            answers: [
              "Roger Federer",
              "Rafael Nadal",
              "Serena Williams",
              "Novak Djokovic"
            ],
            correctAnswer: "Serena Williams"
          },
          {
            question: "In which city were the 2020 Summer Olympics held?",
            code: ``,
            answers: [
              "Beijing",
              "Tokyo",
              "Rio de Janeiro",
              "London"
            ],
            correctAnswer: "Tokyo"
          }
      ],
      conditionals: [
          {
            question: "Which city is known as the 'City of Lights'?",
            code: ``,
            answers: [
              "New York",
              "Paris",
              "Tokyo",
              "London"
            ],
            correctAnswer: "Paris"
          },
          {
            question: "Which country is the largest by land area?",
            code: ``,
            answers: [
              "Canada",
              "China",
              "Russia",
              "United States"
            ],
            correctAnswer: "Russia"
          },
          {
            question: "What is the capital city of Australia?",
            code: ``,
            answers: [
              "Sydney",
              "Melbourne",
              "Canberra",
              "Brisbane"
            ],
            correctAnswer: "Canberra"
          },
          {
            question: "Which country is known as the Land of the Rising Sun?",
            code: ``,
            answers: [
              "Japan",
              "China",
              "South Korea",
              "Thailand"
            ],
            correctAnswer: "Japan"
          },
          {
            question: "Which river is the longest in the world?",
            code: ``,
            answers: [
              "Nile",
              "Amazon",
              "Yangtze",
              "Mississippi"
            ],
            correctAnswer: "Nile"
          }
      ],
      objects: [
        {
          question: "What is the chemical symbol for gold?",
          code: ``,
          answers: [
            "Au",
            "Ag",
            "Pb",
            "Fe"
          ],
          correctAnswer: "Au"
        },
        {
          question: "Who wrote 'To Kill a Mockingbird'?",
          code: ``,
          answers: [
            "Harper Lee",
            "Mark Twain",
            "Ernest Hemingway",
            "F. Scott Fitzgerald"
          ],
          correctAnswer: "Harper Lee"
        },
        {
          question: "What is the hardest natural substance on Earth?",
          code: ``,
          answers: [
            "Gold",
            "Diamond",
            "Platinum",
            "Iron"
          ],
          correctAnswer: "Diamond"
        },
        {
          question: "What planet is known as the Red Planet?",
          code: ``,
          answers: [
            "Mars",
            "Venus",
            "Jupiter",
            "Saturn"
          ],
          correctAnswer: "Mars"
        },
        {
          question: "What is the capital of Canada?",
          code: ``,
          answers: [
            "Toronto",
            "Vancouver",
            "Ottawa",
            "Montreal"
          ],
          correctAnswer: "Ottawa"
        }
      ]

    }
  };

// Make the quiz. Create a model for our app's state
function makeQuiz(){
	// Creating an object to store the app's state when beginning the quiz
	return {
		// Gathering a random question out of the available questions for each category
		questions: helpers.getRandomQuestions(STORE),
		// Boolean for if the quiz is in progress or not
		midQuiz: false,
		// Array of correct/incorrect answers to use for our progress bar
		progress: {
			progressBar: [],
			incorrectCategories: []
		},
		// Boolean to determine if the end state should display
		completed: false,
		// Monitoring which question we are currently on
		currentQuestion: 0,
		// Keeps track of total correct answers
		correctAnswers: 0,
		// Keeps current selected answer
		currentAnswer: "",
		// Keeps track of % completed
		percCorrect: 0
	}
}

// Apply fadeOut animations and set the stage for DOM text/element changes
function $fade(appState){

	// This is the completed state of of a quiz
	if(appState.completed){
		
		// Fade out elements with a promise to avoid choppy behavior
		$.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
			.done(function(){

				// Display results of the quiz
				$showResults(appState);
				$('.results-wrapper').hide().removeClass('hide');
				$('.question-answer-wrapper, .results-wrapper').fadeIn(500);
	    });

	// This is if the app is just starting
	} else if(appState.midQuiz === false){

		// Set a flag that the app has begun
		appState.midQuiz = true;
		// Fade out elements with a promise to avoid choppy behavior
		$.when($('.question-answer-wrapper, .question-wrapper, .code, .answer-wrapper, .start-quiz, .quit-quiz, .results-wrapper, .progress, .progress-bar').fadeOut(500))
			.done(function(){
				// Remove any progress from a previous quiz (if any);
				helpers.updateProgressBar(appState);
				$('.progress-count').html('1 / 10');
				$('.progress-perc').html('');
				// Kill previous results
				$('.failures').remove();
				// Lots to do... mostly just setting up a new environment for a new quiz
				$updateQuestion(appState);
				$('progress-bar').empty();
				$('progress-fill').html('Progress: <span class="progress-count">1 / 10</span><span class="progress-perc"></span>');
				$('.question-answer-wrapper, .answer-wrapper').removeClass('begin');
				$('.submit-btn, .progress, .progress-bar').removeClass('hide');
				$('.progress, .progress-bar').hide();
				$('.question-answer-wrapper, .question-wrapper, .answer-wrapper, .progress, .progress-bar').fadeIn(500);
				if(!$('.code').hasClass('hide')){$('.code').fadeIn(500)};
	    });

	// This is if the app is in the middle of execution
	} else if(appState.midQuiz){
		$.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
			.done(function(){
				$updateQuestion(appState);
				$('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeIn(500);
	    });
	}
}

// Work in progress...
function $showResults(appState){
	if(appState.correctAnswers === 10){
		let endMsg = `You got ${appState.percCorrect}% correct!
I have nothing else to teach you. Move on and prosper!
`;
	} else {
		$('.answer-btn').remove();
		let endMsg = `You got ${appState.percCorrect}% correct!`
		let endFeedback = ``;
		if(appState.progress.incorrectCategories.length === 0){
			endFeedback = `You aced it! Good job!`;
		} else {
			endFeedback = `You may want to study up on the following categories:`;
		}
		
		$('.quiz-end-score').html(endMsg);
		let $failList = $('<ul class="failures"></ul>');
		appState.progress.incorrectCategories.map((cat => {
			$failList.append("<li class='category'>" + cat + "</li>");
		}));
		$('.quiz-end-feedback-p').html(endFeedback);
		$('.quiz-end-categories').append($failList);
		$('.results-wrapper').removeClass('hide').css('display', 'flex');
		$('.question-answer-wrapper, .results-wrapper, .quiz-end-feedback, .quiz-end-score, .retry-btn').css('display', 'flex').fadeIn(500);		
	}

}

// Update the question, code, answers, buttons in the DOM while we're in a faded out state
function $updateQuestion(appState){
	$('.answer-btn').remove();

	// Update the question and code text with the current question
	$('.question').html(appState.questions[appState.currentQuestion].question);

	// This is a hack to hide/show the code portion
	// Only 1/3 of the questions contain code so we hide it if they aren't present
	if(appState.questions[appState.currentQuestion].code == ``){
		$('.code').addClass('hide');
	} else {
		$('.code').removeClass('hide');
		$('.code').html(`<pre>${appState.questions[appState.currentQuestion].code}</pre>`);
	}
	
	// Change continue back to submit
	$('.continue-btn')
		.val("Submit")
		.removeClass('continue-btn')
		.addClass('submit-btn')
		.prop('disabled', true);

	// Add in available answers for the question
	let $answers = [];

	// Adding the answers to a temporary array
	for(let i=0; i<appState.questions[appState.currentQuestion].answers.length; i++){

		// Add current question answers to an array
		let $answer = $('<button class="answer-btn" type="button"></button>');
		$answer.html(appState.questions[appState.currentQuestion].answers[i]);
		$answers.push($answer);
	}

	// Shuffle the answers
	helpers.shuffleAnswers($answers)

	// Push answers to the DOM
	$answers.forEach((answer) => {
		$('.answer-wrapper').prepend(answer);
	});
}

// Simple class and enable/disable DOM selection when answer is selected
function selectAnswer(answer){
	$('.answer-btn').removeClass('selected');
	answer.addClass('selected');
	$('.submit-btn').prop('disabled', false);
}

// Answer is selected and submitted
// Push a feedback state
function submitAnswer(appState){

	// This will be returned true or false based on their answer
	let correct;

	// Add styles to the answers to show if their answer was correct or not
	$('.answer-btn').each(function () {
		if($(this).html() === appState.questions[appState.currentQuestion].correctAnswer){
			$(this).addClass('pass');
			// If answer is correct and selected...
			if($(this).hasClass('selected')){
				correct = "pass";
				appState.correctAnswers++;
				appState.questions[appState.currentQuestion];
			}

		// Handle correct answer if selected answer is incorrect
		} else if ($(this).hasClass('selected')){
			$(this).addClass('fail dim-answer');
			correct = "fail";
			appState.progress.incorrectCategories.push(appState.questions[appState.currentQuestion].category);

		// Dim the other answers to make the correct one more prevalent
		} else {
			$(this).addClass('dim-answer');
		}
	});

	// Add a progress bar indicator to our appState object
	appState.progress.progressBar.push(`<div class="progress-indicator ${correct}"></div>`);
	
	// Update our percent correct (parse a float and set it to a fixed percentage)
	appState.percCorrect = parseFloat(appState.correctAnswers / (appState.currentQuestion + 1) * 100).toFixed();

	// Update our current question VS total quiz length
	$('.progress-count').html(`
		${appState.currentQuestion + 1} / ${appState.questions.length}
	`);

	// Update our current correct percentage
	$('.progress-perc').html(`
		 // ${(appState.percCorrect)}% Correct
	`)

	// Change submit back to continue
	$('.submit-btn')
		.val("Continue")
		.removeClass('submit-btn')
		.addClass('continue-btn')

	// Disable selecting answers
	$('.answer-btn').prop("disabled", true);

	// Update our progress-bar DOM
	helpers.updateProgressBar(appState);

	// Continue to next question
	appState.currentQuestion++;

	// Verify if we're done or not
	if(appState.currentQuestion === appState.questions.length){
		appState.completed = true;
	}
	
}

// Silly easter egg for saying you don't want to do the quiz
function killQuiz(){
	$('.start-quiz, .quit-quiz').hide();
	let failureMsg = "You didn't grow. You didn't improve. You took a shortcut and gained nothing. You experienced a hollow victory. Nothing was risked and nothing was gained. It's sad you don't know the difference..."
	let msgSplit = failureMsg.split(" ");
	let counter = 0;
	$('.question').empty();
	let startTroll = setInterval(function () {
		$('.question').append(msgSplit[counter] + " ");
		counter++;
		if(counter > msgSplit.length - 1){
  			clearInterval(startTroll);
  			$('.start-quiz').text('You can do it! Start Quiz').fadeIn(500);
		}
	}, 250);
}

// These are simple algorithms to modify data that don't need an individual function
let helpers = {
	// Pick a random question from the available ones
	pickRandomQ: function(obj,section){
		return Math.floor(Math.random() * obj.questions[section].length);		
	},
	// Gather a random question from every category
	getRandomQuestions: function(obj){
		let questions = [];
		let categories = Object.keys(obj.questions);
		categories.forEach((cat) => {
			let randomQ = this.pickRandomQ(obj,cat);
			let question = obj.questions[cat][randomQ];
			question.category = cat;
			questions.push(question);
		});
		return questions;
	},
	// Shuffle the answers so they don't appear in the same order
	shuffleAnswers: function(arr){
	    for (var i = arr.length - 1; i > 0; i--) {
	        var j = Math.floor(Math.random() * (i + 1));
	        var temp = arr[i];
	        arr[i] = arr[j];
	        arr[j] = temp;
	    }
	},
	// Update progress bar DOM element
	updateProgressBar: function(appState){
		$('.progress-bar').empty();
		appState.progress.progressBar.forEach((progInd => {
			$('.progress-bar').append(progInd);
		}))
	}
}

// Lets start the show
$(function(){

	// Kill any form refresh
	$('.answer-wrapper').on('submit', function(e){
		e.preventDefault();
	});

	// Storage for quiz app state
	let quizData;

	// Start quiz
	$('.start-quiz, .retry-btn').on('click', function(){
		quizData = makeQuiz();
		$fade(quizData);
	});

	// Select an answer
	$('.question-answer-wrapper').on('click', '.answer-btn', function(){
		selectAnswer($(this));
	})

	// Submit your answer to display feedback and advance question counter
	$('.question-answer-wrapper').on('click', '.submit-btn', function(e){
		submitAnswer(quizData);
	});

	// Submit your answer to display feedback and advance question counter
	$('.question-answer-wrapper').on('click', '.continue-btn', function(){
		$fade(quizData);
	});

	// Easter egg to chastize the user
	$('.quit-quiz').on('click', function(){
		killQuiz();
	})
})
